---
title: "4.8 What's in a name?"
format: html
---

```{r}
library(tidyverse)
library(janitor)
library(ggthemes)
library(googlesheets4)
```

# Step 1: Get the data

```{r}
df = read_sheet("https://docs.google.com/spreadsheets/d/10N_66DA_vbdnrJFlSdklY1yFRst8bnin5w9mC2I5pDc/edit?gid=0#gid=0", sheet = "Sheet1") |> 
  clean_names() |> 
  drop_na()
```

# Step 2: Get the difference of averages for the REAL data

Here's how you get the average for each group:

```{r}
masculine_average = df |> 
  filter(gender == "M") |> 
  pull(rating) |> 
  mean()
masculine_average
```

```{r}
feminine_average = df |> 
  filter(gender == "F") |> 
  pull(rating) |> 
  mean()
feminine_average
```

Here's how you get the difference:

```{r}
our_difference_of_means = masculine_average - feminine_average
our_difference_of_means
```

# Step 3: Ignore gender completely

Here are all the ratings, ignoring gender.

```{r}
ratings = df |> pull(rating)
ratings
```

# Step 4: Label the "gender" randomly

```{r}
number_of_resumes = length(ratings)
pretend_df = tibble(
  # keep the ratings from before
  rating = ratings,
  # but shuffle the gender labels
  gender = sample(c("M", "F"), number_of_resumes, replace = TRUE)
)
```

# Step 5: Get the difference of averages for the PRETEND data

Go look at Step 2

```{r}
masculine_average = #YOUR CODE HERE
feminine_average = #YOURCODE HERE
masculine_average - feminine_average
```

# Step 6: Make a function that runs steps 3-5

```{r}
run_experiment = function(i) {
  pretend_df = tibble(
    # keep the ratings from before
    ratings,
    # but shuffle the gender labels
    gender = sample(c("M", "F"), number_of_resumes, replace = TRUE)
  )
  # This is the same as Step 5:
  masculine_average = #YOUR CODE HERE
  feminine_average = #YOURCODE HERE
  masculine_average - feminine_average
}
```


# Step 7: Simulate 100 experiments IF GENDER DOESN'T MATTER

```{r}
n_experiments = 100
differences_of_means = map_dbl(1:n_experiments, run_experiment)
experiment_results = tibble(difference_of_means = differences_of_means)
```

Graph simulation results (and our actual data in red)

```{r}
experiment_results |> 
  ggplot(aes(x = difference_of_means)) +
  geom_histogram(binwidth = 0.5, fill = "lightgray", color = "black") +
  geom_vline(xintercept = our_difference_of_means, colour = "red") +
  theme_few() +
  theme(legend.position = "none")
```


# Run a t-test on the data

We will learn about this later in the course.

```{r}
masculine = df |> filter(gender == "M") |> pull(rating)
feminine = df |> filter(gender == "F") |> pull(rating)
t.test(masculine, feminine)
```


